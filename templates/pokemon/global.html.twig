{% extends 'base.html.twig' %}

{% block title %}Explorar - Pok√©App{% endblock %}

{% block body %}
    <main class="main">
        
        <div class="page-title" data-aos="fade">
            <div class="container d-lg-flex justify-content-between align-items-center">
                <h1 class="mb-2 mb-lg-0">Explorar Mundo Pok√©mon</h1>
                <nav class="breadcrumbs">
                    <ol>
                        <li><a href="{{ path('app_home') }}">Inicio</a></li>
                        <li class="current">Global</li>
                    </ol>
                </nav>
            </div>
        </div>

        <section id="blog" class="blog section">
            <div class="container">

                <div class="row mb-5" data-aos="fade-up">
                    <div class="col-12">
                        <div class="card shadow-sm border-0 p-4 bg-light">
                            <form method="get" action="{{ path('app_pokemon_global') }}">
                                <div class="row g-3 align-items-end">
                                    
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold small text-muted text-uppercase">Buscar</label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-white border-end-0"><i class="bi bi-search"></i></span>
                                            {# Usamos app.request.query.get para leer lo que hay en la URL #}
                                            <input type="text" name="q" class="form-control border-start-0" placeholder="Nombre o descripci√≥n..." value="{{ app.request.query.get('q') }}">
                                        </div>
                                    </div>

                                    <div class="col-md-3">
                                        <label class="form-label fw-bold small text-muted text-uppercase">Tipo Elemental</label>
                                        <select name="tipo" class="form-select">
                                            <option value="">Todos los Tipos</option>
                                            {% set tipoActual = app.request.query.get('tipo') %}
                                            <option value="Fuego" {{ tipoActual == 'Fuego' ? 'selected' : '' }}>Fuego üî•</option>
                                            <option value="Agua" {{ tipoActual == 'Agua' ? 'selected' : '' }}>Agua üíß</option>
                                            <option value="Planta" {{ tipoActual == 'Planta' ? 'selected' : '' }}>Planta üåø</option>
                                            <option value="El√©ctrico" {{ tipoActual == 'El√©ctrico' ? 'selected' : '' }}>El√©ctrico ‚ö°</option>
                                            <option value="Ps√≠quico" {{ tipoActual == 'Ps√≠quico' ? 'selected' : '' }}>Ps√≠quico üîÆ</option>
                                            <option value="Roca" {{ tipoActual == 'Roca' ? 'selected' : '' }}>Roca ü™®</option>
                                            <option value="Normal" {{ tipoActual == 'Normal' ? 'selected' : '' }}>Normal ‚≠ê</option>
                                        </select>
                                    </div>

                                    <div class="col-md-3">
                                        <label class="form-label fw-bold small text-muted text-uppercase">Fecha Creaci√≥n</label>
                                        <div class="input-group input-group-sm mb-1">
                                            <span class="input-group-text">Desde</span>
                                            <input type="date" name="desde" class="form-control" value="{{ app.request.query.get('desde') }}">
                                        </div>
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text">Hasta&nbsp;</span>
                                            <input type="date" name="hasta" class="form-control" value="{{ app.request.query.get('hasta') }}">
                                        </div>
                                    </div>

                                    <div class="col-md-2 d-grid gap-2">
                                        <button type="submit" class="btn btn-primary fw-bold">Filtrar</button>
                                        <a href="{{ path('app_pokemon_global') }}" class="btn btn-outline-secondary btn-sm">Limpiar</a>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="row gy-4 posts-list">

                    {% for pokemon in pokemons %}
                        <div class="col-xl-4 col-lg-6">
                            <article>
                                <div class="post-img">
                                    <img src="{{ asset('uploads/pokemon/' ~ pokemon.imagen) }}" alt="{{ pokemon.nombre }}" class="img-fluid w-100 rounded-top" style="aspect-ratio: 1/1; object-fit: contain; background-color: #f3f5fa;">
                                </div>

                                <p class="post-category">{{ pokemon.tipo }}</p>

                                <h2 class="title">
                                    <a href="#">{{ pokemon.nombre }}</a>
                                </h2>

                                <div class="d-flex align-items-center">
                                    <div class="post-meta">
                                        <p class="post-author">Entrenador:
                                            <strong>{{ pokemon.entrenador.nombre }}</strong>
                                        </p>
                                        <p class="post-date">
                                            <time datetime="2022-01-01">{{ pokemon.fechaCreacion ? pokemon.fechaCreacion|date('d/m/Y') : 'Fecha desconocida' }}</time>
                                        </p>
                                    </div>
                                </div>

                                <div class="mt-3 text-end">
                                    {% set esFavorito = app.user and app.user.favoritos.contains(pokemon) %}
                                    <a href="{{ path('app_pokemon_toggle_like', {id: pokemon.id}) }}" class="btn {{ esFavorito ? 'btn-danger' : 'btn-outline-danger' }}">
                                        <i class="bi {{ esFavorito ? 'bi-heart-fill' : 'bi-heart' }}"></i>
                                        {{ esFavorito ? 'Te gusta' : 'Me gusta' }}
                                    </a>
                                </div>

                            </article>
                        </div>
                    {% else %}
                        <div class="col-12">
                            <div class="alert alert-info text-center py-5">
                                <h4><i class="bi bi-search"></i> No se encontraron Pok√©mon</h4>
                                <p>Intenta cambiar los filtros de b√∫squeda.</p>
                            </div>
                        </div>
                    {% endfor %}

                </div>
            </div>
        </section>
    </main>
{% endblock %}